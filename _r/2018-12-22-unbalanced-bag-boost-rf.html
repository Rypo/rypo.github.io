---
title: "Multi-Model Approach to Unbalanced Data with Caravan Dataset"
permalink: /r/unbalanced-data-caravan
excerpt: "2016 Kaggle Caravan Insurance Challenge (Part 1 of 2). Dealing with unbalanced data."
categories: [r, multimodel, classification]
tags: [r, unbalanced, SMOTE, undersampling,oversampling, RandomForest, Bagging, Boosting]
layout: rmd
author: "Ryan Gust"
date: 2018-12-22
last_modified_at: 2019-01-17
header:
  teaser: assets/images/thumbs/chart-unsplash-lchesser.png
---

<div id="overview" class="section level2">
<h2>Overview</h2>
<p>This notebook will look at the 2016 Kaggle Caravan Insurance Challenge. The data was collected to see with the following goal in mind: &gt; Can you predict who would be interested in buying a caravan insurance policy and give an explanation why?</p>
<p>Several models will be used in attempting to answer this question:</p>
<ul>
<li>Bagging</li>
<li>Boosting (2 variants)</li>
<li>Random Forest</li>
</ul>
<p>As we are working with unbalanced data, each model will have be run against a training dataset in 4 different states: * Unbalanced (No modifications) * Undersampled * Oversampled * SMOTE * ROSE</p>
<div id="imports" class="section level3">
<h3>Imports</h3>
<pre class="r"><code>library(tidyverse)
library(reshape2)
library(gridExtra)
library(caret) # Various models package
library(xgboost)
library(DMwR) # SMOTE
library(pROC) # ROC AUC Plotting</code></pre>
</div>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>The dataset used is from the CoIL Challenge 2000 datamining competition. It may be obtained from: <a href="https://www.kaggle.com/uciml/caravan-insurance-challenge" class="uri">https://www.kaggle.com/uciml/caravan-insurance-challenge</a></p>
<p>It contains information on customers of an insurance company. The data consists of 86 variables and includes product usage data and socio-demographic data derived from zip area codes.</p>
<p>A description of each variable may be found in <code>data_dfns.md</code> or at the <a href="https://www.kaggle.com/uciml/caravan-insurance-challenge">link listed above</a>.</p>
<p>Each number corresponds with a certain key, specific to each variable. There are 5 levels of keys, L0-L4 each key represents a different group range. As a sample:</p>
<pre><code>L0 - Customer subtype (1-41)
    1: High Income, expensive child
    2: Very Important Provincials
    3: High status seniors
    ...
L1 - average age keys (1-6):
    1: 20-30 years 
    2: 30-40 years 
    3: 40-50 years 
    ...
L2 - customer main type keys (1-10):
    1: Successful hedonists
    2: Driven Growers
    3: Average Family
    ...
L3 - percentage keys (0-9):
    0: 0%
    1: 1 - 10%
    2: 11 - 23%
    3: 24 - 36%
    ...
L4 - total number keys (0-9):
    0: 0
    1: 1 - 49
    2: 50 - 99
    3: 100 - 199
    ...</code></pre>
<p>The variable descriptions are quite important as it appears as though the variable names themselves are abbreviated in Dutch. One helpful pattern to notice is the letters that variables begin with:</p>
<ul>
<li><strong>M</strong> - primary demographics?, no guess for abbreviation</li>
<li><strong>A</strong> - numbers, possibly for dutch word <em>aantal</em></li>
<li><strong>P</strong> - percents, possibly for dutch word <em>procent</em></li>
</ul>
<hr />
<p><strong>Acknowledgements</strong></p>
<p>P. van der Putten and M. van Someren (eds) . CoIL Challenge 2000: The Insurance Company Case. Published by Sentient Machine Research, Amsterdam. Also a Leiden Institute of Advanced Computer Science Technical Report 2000-09. June 22, 2000.</p>
<pre class="r"><code>head(cic &lt;- read.csv(&#39;data/caravan-insurance-challenge.csv&#39;), n=30)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["ORIGIN"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["MOSTYPE"],"name":[2],"type":["int"],"align":["right"]},{"label":["MAANTHUI"],"name":[3],"type":["int"],"align":["right"]},{"label":["MGEMOMV"],"name":[4],"type":["int"],"align":["right"]},{"label":["MGEMLEEF"],"name":[5],"type":["int"],"align":["right"]},{"label":["MOSHOOFD"],"name":[6],"type":["int"],"align":["right"]},{"label":["MGODRK"],"name":[7],"type":["int"],"align":["right"]},{"label":["MGODPR"],"name":[8],"type":["int"],"align":["right"]},{"label":["MGODOV"],"name":[9],"type":["int"],"align":["right"]},{"label":["MGODGE"],"name":[10],"type":["int"],"align":["right"]},{"label":["MRELGE"],"name":[11],"type":["int"],"align":["right"]},{"label":["MRELSA"],"name":[12],"type":["int"],"align":["right"]},{"label":["MRELOV"],"name":[13],"type":["int"],"align":["right"]},{"label":["MFALLEEN"],"name":[14],"type":["int"],"align":["right"]},{"label":["MFGEKIND"],"name":[15],"type":["int"],"align":["right"]},{"label":["MFWEKIND"],"name":[16],"type":["int"],"align":["right"]},{"label":["MOPLHOOG"],"name":[17],"type":["int"],"align":["right"]},{"label":["MOPLMIDD"],"name":[18],"type":["int"],"align":["right"]},{"label":["MOPLLAAG"],"name":[19],"type":["int"],"align":["right"]},{"label":["MBERHOOG"],"name":[20],"type":["int"],"align":["right"]},{"label":["MBERZELF"],"name":[21],"type":["int"],"align":["right"]},{"label":["MBERBOER"],"name":[22],"type":["int"],"align":["right"]},{"label":["MBERMIDD"],"name":[23],"type":["int"],"align":["right"]},{"label":["MBERARBG"],"name":[24],"type":["int"],"align":["right"]},{"label":["MBERARBO"],"name":[25],"type":["int"],"align":["right"]},{"label":["MSKA"],"name":[26],"type":["int"],"align":["right"]},{"label":["MSKB1"],"name":[27],"type":["int"],"align":["right"]},{"label":["MSKB2"],"name":[28],"type":["int"],"align":["right"]},{"label":["MSKC"],"name":[29],"type":["int"],"align":["right"]},{"label":["MSKD"],"name":[30],"type":["int"],"align":["right"]},{"label":["MHHUUR"],"name":[31],"type":["int"],"align":["right"]},{"label":["MHKOOP"],"name":[32],"type":["int"],"align":["right"]},{"label":["MAUT1"],"name":[33],"type":["int"],"align":["right"]},{"label":["MAUT2"],"name":[34],"type":["int"],"align":["right"]},{"label":["MAUT0"],"name":[35],"type":["int"],"align":["right"]},{"label":["MZFONDS"],"name":[36],"type":["int"],"align":["right"]},{"label":["MZPART"],"name":[37],"type":["int"],"align":["right"]},{"label":["MINKM30"],"name":[38],"type":["int"],"align":["right"]},{"label":["MINK3045"],"name":[39],"type":["int"],"align":["right"]},{"label":["MINK4575"],"name":[40],"type":["int"],"align":["right"]},{"label":["MINK7512"],"name":[41],"type":["int"],"align":["right"]},{"label":["MINK123M"],"name":[42],"type":["int"],"align":["right"]},{"label":["MINKGEM"],"name":[43],"type":["int"],"align":["right"]},{"label":["MKOOPKLA"],"name":[44],"type":["int"],"align":["right"]},{"label":["PWAPART"],"name":[45],"type":["int"],"align":["right"]},{"label":["PWABEDR"],"name":[46],"type":["int"],"align":["right"]},{"label":["PWALAND"],"name":[47],"type":["int"],"align":["right"]},{"label":["PPERSAUT"],"name":[48],"type":["int"],"align":["right"]},{"label":["PBESAUT"],"name":[49],"type":["int"],"align":["right"]},{"label":["PMOTSCO"],"name":[50],"type":["int"],"align":["right"]},{"label":["PVRAAUT"],"name":[51],"type":["int"],"align":["right"]},{"label":["PAANHANG"],"name":[52],"type":["int"],"align":["right"]},{"label":["PTRACTOR"],"name":[53],"type":["int"],"align":["right"]},{"label":["PWERKT"],"name":[54],"type":["int"],"align":["right"]},{"label":["PBROM"],"name":[55],"type":["int"],"align":["right"]},{"label":["PLEVEN"],"name":[56],"type":["int"],"align":["right"]},{"label":["PPERSONG"],"name":[57],"type":["int"],"align":["right"]},{"label":["PGEZONG"],"name":[58],"type":["int"],"align":["right"]},{"label":["PWAOREG"],"name":[59],"type":["int"],"align":["right"]},{"label":["PBRAND"],"name":[60],"type":["int"],"align":["right"]},{"label":["PZEILPL"],"name":[61],"type":["int"],"align":["right"]},{"label":["PPLEZIER"],"name":[62],"type":["int"],"align":["right"]},{"label":["PFIETS"],"name":[63],"type":["int"],"align":["right"]},{"label":["PINBOED"],"name":[64],"type":["int"],"align":["right"]},{"label":["PBYSTAND"],"name":[65],"type":["int"],"align":["right"]},{"label":["AWAPART"],"name":[66],"type":["int"],"align":["right"]},{"label":["AWABEDR"],"name":[67],"type":["int"],"align":["right"]},{"label":["AWALAND"],"name":[68],"type":["int"],"align":["right"]},{"label":["APERSAUT"],"name":[69],"type":["int"],"align":["right"]},{"label":["ABESAUT"],"name":[70],"type":["int"],"align":["right"]},{"label":["AMOTSCO"],"name":[71],"type":["int"],"align":["right"]},{"label":["AVRAAUT"],"name":[72],"type":["int"],"align":["right"]},{"label":["AAANHANG"],"name":[73],"type":["int"],"align":["right"]},{"label":["ATRACTOR"],"name":[74],"type":["int"],"align":["right"]},{"label":["AWERKT"],"name":[75],"type":["int"],"align":["right"]},{"label":["ABROM"],"name":[76],"type":["int"],"align":["right"]},{"label":["ALEVEN"],"name":[77],"type":["int"],"align":["right"]},{"label":["APERSONG"],"name":[78],"type":["int"],"align":["right"]},{"label":["AGEZONG"],"name":[79],"type":["int"],"align":["right"]},{"label":["AWAOREG"],"name":[80],"type":["int"],"align":["right"]},{"label":["ABRAND"],"name":[81],"type":["int"],"align":["right"]},{"label":["AZEILPL"],"name":[82],"type":["int"],"align":["right"]},{"label":["APLEZIER"],"name":[83],"type":["int"],"align":["right"]},{"label":["AFIETS"],"name":[84],"type":["int"],"align":["right"]},{"label":["AINBOED"],"name":[85],"type":["int"],"align":["right"]},{"label":["ABYSTAND"],"name":[86],"type":["int"],"align":["right"]},{"label":["CARAVAN"],"name":[87],"type":["int"],"align":["right"]}],"data":[{"1":"train","2":"33","3":"1","4":"3","5":"2","6":"8","7":"0","8":"5","9":"1","10":"3","11":"7","12":"0","13":"2","14":"1","15":"2","16":"6","17":"1","18":"2","19":"7","20":"1","21":"0","22":"1","23":"2","24":"5","25":"2","26":"1","27":"1","28":"2","29":"6","30":"1","31":"1","32":"8","33":"8","34":"0","35":"1","36":"8","37":"1","38":"0","39":"4","40":"5","41":"0","42":"0","43":"4","44":"3","45":"0","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"5","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"1"},{"1":"train","2":"37","3":"1","4":"2","5":"2","6":"8","7":"1","8":"4","9":"1","10":"4","11":"6","12":"2","13":"2","14":"0","15":"4","16":"5","17":"0","18":"5","19":"4","20":"0","21":"0","22":"0","23":"5","24":"0","25":"4","26":"0","27":"2","28":"3","29":"5","30":"0","31":"2","32":"7","33":"7","34":"1","35":"2","36":"6","37":"3","38":"2","39":"0","40":"5","41":"2","42":"0","43":"5","44":"4","45":"2","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"2","61":"0","62":"0","63":"0","64":"0","65":"0","66":"2","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"2"},{"1":"train","2":"37","3":"1","4":"2","5":"2","6":"8","7":"0","8":"4","9":"2","10":"4","11":"3","12":"2","13":"4","14":"4","15":"4","16":"2","17":"0","18":"5","19":"4","20":"0","21":"0","22":"0","23":"7","24":"0","25":"2","26":"0","27":"5","28":"0","29":"4","30":"0","31":"7","32":"2","33":"7","34":"0","35":"2","36":"9","37":"0","38":"4","39":"5","40":"0","41":"0","42":"0","43":"3","44":"4","45":"2","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"2","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"3"},{"1":"train","2":"9","3":"1","4":"3","5":"3","6":"3","7":"2","8":"3","9":"2","10":"4","11":"5","12":"2","13":"2","14":"2","15":"3","16":"4","17":"3","18":"4","19":"2","20":"4","21":"0","22":"0","23":"3","24":"1","25":"2","26":"3","27":"2","28":"1","29":"4","30":"0","31":"5","32":"4","33":"9","34":"0","35":"0","36":"7","37":"2","38":"1","39":"5","40":"3","41":"0","42":"0","43":"4","44":"4","45":"0","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"2","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"4"},{"1":"train","2":"40","3":"1","4":"4","5":"2","6":"10","7":"1","8":"4","9":"1","10":"4","11":"7","12":"1","13":"2","14":"2","15":"4","16":"4","17":"5","18":"4","19":"0","20":"0","21":"5","22":"4","23":"0","24":"0","25":"0","26":"9","27":"0","28":"0","29":"0","30":"0","31":"4","32":"5","33":"6","34":"2","35":"1","36":"5","37":"4","38":"0","39":"0","40":"9","41":"0","42":"0","43":"6","44":"3","45":"0","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"6","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"5"},{"1":"train","2":"23","3":"1","4":"2","5":"1","6":"5","7":"0","8":"5","9":"0","10":"5","11":"0","12":"6","13":"3","14":"3","15":"5","16":"2","17":"0","18":"5","19":"4","20":"2","21":"0","22":"0","23":"4","24":"2","25":"2","26":"2","27":"2","28":"2","29":"4","30":"2","31":"9","32":"0","33":"5","34":"3","35":"3","36":"9","37":"0","38":"5","39":"2","40":"3","41":"0","42":"0","43":"3","44":"3","45":"0","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"6"},{"1":"train","2":"39","3":"2","4":"3","5":"2","6":"9","7":"2","8":"2","9":"0","10":"5","11":"7","12":"2","13":"0","14":"0","15":"3","16":"6","17":"0","18":"4","19":"5","20":"0","21":"0","22":"0","23":"4","24":"1","25":"5","26":"0","27":"1","28":"4","29":"5","30":"0","31":"6","32":"3","33":"8","34":"0","35":"1","36":"9","37":"0","38":"4","39":"3","40":"3","41":"0","42":"0","43":"3","44":"5","45":"0","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"7"},{"1":"train","2":"33","3":"1","4":"2","5":"3","6":"8","7":"0","8":"7","9":"0","10":"2","11":"7","12":"2","13":"0","14":"0","15":"5","16":"4","17":"0","18":"3","19":"6","20":"2","21":"0","22":"0","23":"2","24":"5","25":"2","26":"2","27":"1","28":"2","29":"5","30":"2","31":"0","32":"9","33":"4","34":"4","35":"2","36":"6","37":"3","38":"2","39":"5","40":"3","41":"0","42":"0","43":"3","44":"3","45":"0","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"3","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"1","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"8"},{"1":"train","2":"33","3":"1","4":"2","5":"4","6":"8","7":"0","8":"1","9":"3","10":"6","11":"6","12":"0","13":"3","14":"3","15":"3","16":"3","17":"0","18":"1","19":"8","20":"1","21":"1","22":"0","23":"1","24":"8","25":"1","26":"1","27":"1","28":"0","29":"8","30":"1","31":"9","32":"0","33":"5","34":"2","35":"3","36":"7","37":"2","38":"7","39":"2","40":"1","41":"0","42":"0","43":"2","44":"3","45":"0","46":"0","47":"0","48":"5","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"9"},{"1":"train","2":"11","3":"2","4":"3","5":"3","6":"3","7":"3","8":"5","9":"0","10":"2","11":"7","12":"0","13":"2","14":"2","15":"2","16":"6","17":"0","18":"4","19":"5","20":"2","21":"0","22":"0","23":"3","24":"3","25":"3","26":"1","27":"2","28":"1","29":"4","30":"2","31":"0","32":"9","33":"6","34":"1","35":"2","36":"6","37":"3","38":"2","39":"3","40":"3","41":"1","42":"0","43":"4","44":"7","45":"2","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"3","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"10"},{"1":"train","2":"10","3":"1","4":"4","5":"3","6":"3","7":"1","8":"4","9":"1","10":"4","11":"7","12":"1","13":"2","14":"0","15":"3","16":"6","17":"4","18":"3","19":"3","20":"0","21":"0","22":"0","23":"9","24":"0","25":"0","26":"3","27":"0","28":"6","29":"0","30":"0","31":"0","32":"9","33":"6","34":"2","35":"1","36":"5","37":"4","38":"0","39":"3","40":"2","41":"2","42":"2","43":"8","44":"7","45":"0","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"11"},{"1":"train","2":"9","3":"1","4":"3","5":"3","6":"3","7":"1","8":"3","9":"2","10":"4","11":"7","12":"1","13":"2","14":"2","15":"3","16":"5","17":"1","18":"7","19":"1","20":"4","21":"0","22":"0","23":"5","24":"1","25":"1","26":"2","27":"3","28":"4","29":"1","30":"0","31":"6","32":"3","33":"7","34":"1","35":"2","36":"4","37":"5","38":"3","39":"4","40":"3","41":"1","42":"0","43":"3","44":"4","45":"2","46":"0","47":"0","48":"5","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"2","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"12"},{"1":"train","2":"33","3":"1","4":"2","5":"3","6":"8","7":"1","8":"4","9":"1","10":"4","11":"6","12":"2","13":"3","14":"3","15":"4","16":"3","17":"1","18":"4","19":"5","20":"1","21":"1","22":"0","23":"3","24":"2","25":"4","26":"1","27":"2","28":"2","29":"5","30":"1","31":"5","32":"4","33":"6","34":"1","35":"3","36":"7","37":"2","38":"3","39":"4","40":"3","41":"1","42":"0","43":"3","44":"3","45":"0","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"13"},{"1":"train","2":"41","3":"1","4":"3","5":"3","6":"10","7":"0","8":"5","9":"0","10":"4","11":"7","12":"1","13":"1","14":"1","15":"4","16":"5","17":"2","18":"4","19":"4","20":"3","21":"0","22":"1","23":"2","24":"2","25":"2","26":"4","27":"2","28":"1","29":"4","30":"0","31":"5","32":"4","33":"7","34":"2","35":"0","36":"8","37":"1","38":"3","39":"2","40":"4","41":"1","42":"0","43":"4","44":"4","45":"0","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"14"},{"1":"train","2":"23","3":"1","4":"1","5":"2","6":"5","7":"0","8":"6","9":"1","10":"2","11":"1","12":"2","13":"6","14":"5","15":"3","16":"1","17":"2","18":"6","19":"2","20":"1","21":"0","22":"0","23":"4","24":"3","25":"2","26":"1","27":"3","28":"2","29":"4","30":"0","31":"9","32":"0","33":"5","34":"1","35":"3","36":"5","37":"4","38":"4","39":"3","40":"3","41":"0","42":"0","43":"3","44":"3","45":"2","46":"0","47":"0","48":"5","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"2","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"15"},{"1":"train","2":"33","3":"1","4":"2","5":"3","6":"8","7":"0","8":"7","9":"0","10":"2","11":"7","12":"2","13":"0","14":"0","15":"5","16":"4","17":"0","18":"3","19":"6","20":"2","21":"0","22":"0","23":"2","24":"5","25":"2","26":"2","27":"1","28":"2","29":"5","30":"2","31":"0","32":"9","33":"4","34":"4","35":"2","36":"6","37":"3","38":"2","39":"5","40":"3","41":"0","42":"0","43":"3","44":"3","45":"2","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"4","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"16"},{"1":"train","2":"38","3":"1","4":"2","5":"3","6":"9","7":"0","8":"6","9":"0","10":"3","11":"7","12":"0","13":"2","14":"0","15":"6","16":"3","17":"2","18":"6","19":"2","20":"2","21":"0","22":"0","23":"4","24":"0","25":"4","26":"2","27":"2","28":"4","29":"2","30":"0","31":"6","32":"3","33":"7","34":"2","35":"0","36":"4","37":"5","38":"0","39":"1","40":"6","41":"2","42":"0","43":"5","44":"4","45":"0","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"17"},{"1":"train","2":"22","3":"2","4":"3","5":"3","6":"5","7":"0","8":"5","9":"0","10":"4","11":"7","12":"0","13":"2","14":"0","15":"2","16":"7","17":"2","18":"1","19":"7","20":"0","21":"2","22":"0","23":"1","24":"1","25":"5","26":"2","27":"0","28":"0","29":"7","30":"0","31":"4","32":"5","33":"6","34":"1","35":"2","36":"7","37":"2","38":"0","39":"6","40":"3","41":"0","42":"0","43":"4","44":"2","45":"2","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"3","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"18"},{"1":"train","2":"13","3":"1","4":"4","5":"2","6":"3","7":"2","8":"4","9":"0","10":"3","11":"7","12":"0","13":"2","14":"1","15":"3","16":"6","17":"5","18":"4","19":"1","20":"6","21":"0","22":"0","23":"3","24":"0","25":"1","26":"5","27":"2","28":"1","29":"2","30":"0","31":"4","32":"5","33":"7","34":"1","35":"2","36":"5","37":"4","38":"2","39":"2","40":"6","41":"0","42":"0","43":"4","44":"6","45":"2","46":"0","47":"0","48":"5","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"2","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"19"},{"1":"train","2":"31","3":"1","4":"2","5":"4","6":"7","7":"0","8":"2","9":"0","10":"7","11":"9","12":"0","13":"0","14":"0","15":"6","16":"3","17":"0","18":"0","19":"9","20":"0","21":"0","22":"0","23":"2","24":"4","25":"4","26":"0","27":"0","28":"0","29":"7","30":"2","31":"9","32":"0","33":"7","34":"2","35":"0","36":"9","37":"0","38":"5","39":"4","40":"0","41":"0","42":"0","43":"3","44":"1","45":"0","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"3","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"1","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"20"},{"1":"train","2":"33","3":"1","4":"4","5":"3","6":"8","7":"0","8":"6","9":"0","10":"3","11":"9","12":"0","13":"0","14":"0","15":"3","16":"6","17":"0","18":"0","19":"9","20":"0","21":"0","22":"3","23":"0","24":"6","25":"0","26":"0","27":"0","28":"3","29":"6","30":"0","31":"9","32":"0","33":"7","34":"2","35":"0","36":"9","37":"0","38":"3","39":"5","40":"2","41":"0","42":"0","43":"3","44":"3","45":"0","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"21"},{"1":"train","2":"33","3":"2","4":"3","5":"3","6":"8","7":"0","8":"4","9":"2","10":"3","11":"7","12":"0","13":"2","14":"0","15":"2","16":"7","17":"0","18":"2","19":"7","20":"0","21":"0","22":"2","23":"4","24":"0","25":"3","26":"0","27":"0","28":"5","29":"4","30":"0","31":"0","32":"9","33":"7","34":"0","35":"2","36":"9","37":"0","38":"3","39":"6","40":"0","41":"0","42":"0","43":"3","44":"3","45":"2","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"4","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"22"},{"1":"train","2":"13","3":"1","4":"3","5":"2","6":"3","7":"1","8":"7","9":"0","10":"2","11":"7","12":"0","13":"2","14":"1","15":"3","16":"6","17":"3","18":"5","19":"1","20":"6","21":"0","22":"0","23":"2","24":"0","25":"1","26":"6","27":"1","28":"3","29":"1","30":"0","31":"4","32":"5","33":"7","34":"2","35":"1","36":"5","37":"4","38":"1","39":"1","40":"8","41":"0","42":"0","43":"5","44":"6","45":"2","46":"0","47":"0","48":"6","49":"0","50":"4","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"4","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"1","70":"0","71":"1","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"23"},{"1":"train","2":"34","3":"2","4":"3","5":"2","6":"8","7":"0","8":"7","9":"0","10":"2","11":"7","12":"2","13":"0","14":"0","15":"4","16":"5","17":"0","18":"2","19":"7","20":"0","21":"2","22":"0","23":"2","24":"4","25":"2","26":"0","27":"0","28":"4","29":"5","30":"0","31":"2","32":"7","33":"5","34":"4","35":"0","36":"9","37":"0","38":"0","39":"5","40":"4","41":"0","42":"0","43":"4","44":"6","45":"0","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"24"},{"1":"train","2":"13","3":"2","4":"4","5":"3","6":"3","7":"0","8":"4","9":"2","10":"4","11":"8","12":"1","13":"1","14":"1","15":"3","16":"6","17":"1","18":"7","19":"2","20":"4","21":"0","22":"0","23":"3","24":"3","25":"0","26":"1","27":"3","28":"3","29":"3","30":"0","31":"1","32":"8","33":"8","34":"0","35":"1","36":"4","37":"5","38":"0","39":"5","40":"4","41":"0","42":"0","43":"4","44":"6","45":"0","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"1","64":"0","65":"0","66":"0","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"1","85":"0","86":"0","87":"0","_rn_":"25"},{"1":"train","2":"33","3":"1","4":"3","5":"3","6":"8","7":"0","8":"6","9":"1","10":"2","11":"6","12":"0","13":"3","14":"2","15":"3","16":"5","17":"1","18":"2","19":"6","20":"1","21":"0","22":"1","23":"4","24":"2","25":"4","26":"1","27":"2","28":"2","29":"5","30":"2","31":"2","32":"7","33":"7","34":"0","35":"2","36":"7","37":"2","38":"0","39":"4","40":"5","41":"0","42":"0","43":"4","44":"3","45":"2","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"4","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"26"},{"1":"train","2":"37","3":"1","4":"3","5":"3","6":"8","7":"0","8":"5","9":"0","10":"4","11":"7","12":"2","13":"0","14":"0","15":"3","16":"6","17":"3","18":"5","19":"2","20":"1","21":"0","22":"0","23":"5","24":"2","25":"2","26":"1","27":"3","28":"3","29":"2","30":"1","31":"8","32":"1","33":"9","34":"0","35":"0","36":"5","37":"4","38":"2","39":"3","40":"3","41":"2","42":"0","43":"5","44":"4","45":"0","46":"0","47":"0","48":"6","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"1","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"27"},{"1":"train","2":"40","3":"1","4":"3","5":"3","6":"10","7":"0","8":"3","9":"0","10":"6","11":"9","12":"0","13":"0","14":"0","15":"4","16":"5","17":"2","18":"0","19":"7","20":"2","21":"0","22":"5","23":"0","24":"2","25":"0","26":"2","27":"1","28":"5","29":"3","30":"0","31":"2","32":"7","33":"7","34":"2","35":"0","36":"7","37":"2","38":"4","39":"2","40":"4","41":"0","42":"0","43":"3","44":"3","45":"2","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"3","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"28"},{"1":"train","2":"31","3":"1","4":"4","5":"2","6":"7","7":"0","8":"9","9":"0","10":"0","11":"5","12":"0","13":"4","14":"0","15":"0","16":"9","17":"0","18":"0","19":"9","20":"0","21":"0","22":"2","23":"0","24":"3","25":"5","26":"0","27":"4","28":"0","29":"5","30":"0","31":"9","32":"0","33":"3","34":"2","35":"4","36":"7","37":"2","38":"9","39":"0","40":"0","41":"0","42":"0","43":"1","44":"1","45":"0","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"3","56":"0","57":"0","58":"0","59":"0","60":"0","61":"0","62":"0","63":"0","64":"0","65":"0","66":"0","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"1","77":"0","78":"0","79":"0","80":"0","81":"0","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"29"},{"1":"train","2":"33","3":"2","4":"2","5":"3","6":"8","7":"0","8":"7","9":"1","10":"2","11":"5","12":"1","13":"4","14":"4","15":"1","16":"5","17":"0","18":"2","19":"7","20":"0","21":"0","22":"1","23":"2","24":"6","25":"1","26":"0","27":"2","28":"1","29":"7","30":"1","31":"8","32":"1","33":"5","34":"1","35":"4","36":"8","37":"1","38":"5","39":"3","40":"2","41":"0","42":"0","43":"3","44":"3","45":"2","46":"0","47":"0","48":"0","49":"0","50":"0","51":"0","52":"0","53":"0","54":"0","55":"0","56":"0","57":"0","58":"0","59":"0","60":"3","61":"0","62":"0","63":"0","64":"0","65":"0","66":"1","67":"0","68":"0","69":"0","70":"0","71":"0","72":"0","73":"0","74":"0","75":"0","76":"0","77":"0","78":"0","79":"0","80":"0","81":"1","82":"0","83":"0","84":"0","85":"0","86":"0","87":"0","_rn_":"30"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="exploratory-data-analysis" class="section level2">
<h2>Exploratory Data Analysis</h2>
<p>No NA values, all variables are type of int64. The data is peculiar in that every numeric value stands for an attribute of a person. Even variables that could be continuous, such as income, have been binned. In this sense, this dataset is entirely comprised of Categorical and Ordinal values. Other than potential collinearity between percentage and range values, the data is mostly clean.</p>
<p>For the EDA portion, we will cheat a bit and use knowledge from the combined dataset to get a better picture of the data. During the actual competition, contestants would not have had access to the <code>CARAVAN</code> variable where <code>ORIGIN</code> = <code>train</code></p>
<pre class="r"><code>cic %&gt;% count(ORIGIN, CARAVAN)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["ORIGIN"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["CARAVAN"],"name":[2],"type":["int"],"align":["right"]},{"label":["n"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"test","2":"0","3":"3762"},{"1":"test","2":"1","3":"238"},{"1":"train","2":"0","3":"5474"},{"1":"train","2":"1","3":"348"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>In both the given and hidden datasets we extremely imbalanced data. For every sample where caravan insurance was purchased, there are over 15 non-purchase cases. Attempting to run models without accounting for this descrepancy will surely impact the quality of our results.</p>
<pre class="r"><code># melt down a correlation matrix for plotting
cormat &lt;- cic %&gt;% subset(select=-c(ORIGIN)) %&gt;% cor()
mcor &lt;- cormat %&gt;% melt()</code></pre>
<pre class="r"><code>mcor %&gt;% ggplot(aes(x=Var1, y=Var2, fill=value)) +
  geom_tile(color=&quot;white&quot;) + 
  scale_fill_gradient2(low= &quot;blue&quot;, high = &quot;red&quot;, mid = &quot;white&quot;) + 
  theme(axis.text.x = element_text(angle = 90))</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-5-1.png" width="1152" /></p>
<pre class="r"><code>f43 &lt;- unique(mcor$Var2)[0:43]

h1cor &lt;- mcor %&gt;% filter(Var1 %in% f43 &amp; Var2 %in% f43)
h2cor &lt;- mcor %&gt;% filter(!(Var1 %in% f43) &amp; !(Var2 %in% f43))

p1 &lt;- h1cor %&gt;% 
  ggplot(aes(x=Var1, y=Var2, fill=value)) + 
  ggtitle(&quot;Quadrant III&quot;) + geom_tile(color=&quot;white&quot;) + 
  scale_fill_gradient2(low= &quot;blue&quot;, high = &quot;red&quot;, mid = &quot;white&quot;) + 
  theme(axis.text.x = element_text(angle = 90))

p2 &lt;- h2cor %&gt;% 
  ggplot(aes(x=Var1, y=Var2, fill=value)) + 
  ggtitle(&quot;Quadrant I&quot;) + geom_tile(color=&quot;white&quot;) + 
  scale_fill_gradient2(low= &quot;blue&quot;, high = &quot;red&quot;, mid = &quot;white&quot;) + 
  theme(axis.text.x = element_text(angle = 90))

grid.arrange(p1, p2, nrow = 1)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-6-1.png" width="1344" /></p>
<p>After zooming in a bit, the Quadrant I, L4 keys plot (right) shows how variables starting with <code>P</code> each have a corresponding variable starting with <code>A</code> this means that having both in our data will likely provide little value to the analysis.</p>
</div>
<div id="models" class="section level2">
<h2>Models</h2>
<p>4 Models will be used in total: <code>BaggingClassifier</code>, <code>RandomForestClassifier</code>, <code>AdaBoostClassifier</code> from caret and <code>xgboost</code></p>
<pre class="r"><code>cic_data &lt;- select(cic, -c(ORIGIN))
cic_data$CARAVAN &lt;- factor(cic_data$CARAVAN, labels=c(&quot;No&quot;,&quot;Yes&quot;))</code></pre>
<p>Some models will not accept 0,1 as factor levels so assigning labels of <code>No</code>,<code>Yes</code> provides a quick work around. This will need to be undone for before using xgboost, as this model requires numeric levels for response variables.</p>
<pre class="r"><code># split data into train test
idx &lt;- createDataPartition(cic_data$CARAVAN, p=0.75, list = FALSE)
train_data &lt;- cic_data[idx,]
test_data &lt;- cic_data[-idx,]</code></pre>
<pre class="r"><code>down_train &lt;- downSample(x=select(train_data,-c(CARAVAN)), y=train_data$CARAVAN, yname=&quot;CARAVAN&quot;)
up_train &lt;- upSample(x=select(train_data,-c(CARAVAN)), y=train_data$CARAVAN, yname=&quot;CARAVAN&quot;)
smote_train &lt;- SMOTE(CARAVAN ~., data = train_data)
#rose_train &lt;- ROSE(CARAVAN ~., data = train_data)$data

props &lt;- data.frame(bind_rows(table(train_data$CARAVAN),
                     table(down_train$CARAVAN),
                     table(up_train$CARAVAN),
                     table(smote_train$CARAVAN)),
                     #table(rose_train$CARAVAN)), 
                    row.names = c(&#39;Unbalanced&#39;,&#39;Downsample&#39;,&#39;Upsample&#39;,&#39;SMOTE&#39;))
props$Total &lt;- props$No+props$Yes
props</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["No"],"name":[1],"type":["int"],"align":["right"]},{"label":["Yes"],"name":[2],"type":["int"],"align":["right"]},{"label":["Total"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"6927","2":"440","3":"7367","_rn_":"Unbalanced"},{"1":"440","2":"440","3":"880","_rn_":"Downsample"},{"1":"6927","2":"6927","3":"13854","_rn_":"Upsample"},{"1":"1760","2":"1320","3":"3080","_rn_":"SMOTE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>We can see here how the various methods of resampling affected the training data proportions. Only upsampling increased the size of the training set, all others used a decreasing or size maintaining rebalancing approach.</p>
<ul>
<li><strong>Random Downsampling</strong></li>
<li><strong>Random Upsampling</strong></li>
<li><strong>SMOTE</strong></li>
<li><del><strong>ROSE</strong> - Random Over-Sampling Examples, produces a synthetic, possibly balanced, sample of data simulated according to a smoothed-bootstrap approach. This approach is similar to SMOTE in that it entirely new data is created rather than simply randomly sampling from the existing data.</del></li>
</ul>
<p><em><a href="https://cran.r-project.org/web/packages/ROSE/ROSE.pdf">ROSE</a> was previously included, but the algorithms usefulness has been debated and for this particular dataset, it consistantly performed far worse than the other three methods.</em></p>
<pre class="r"><code>cfmROC &lt;- function(y_pred, y_true){

  cm &lt;- confusionMatrix(y_pred, y_true)
  rocobj &lt;- roc(as.numeric(y_true)-1, as.numeric(y_pred)-1) 
  
  # Plot ROC AUC
  p1 &lt;- ggroc(rocobj, alpha = 0.5, colour = &quot;red&quot;, linetype = 2, size = 2) + 
    geom_line(aes(x = rocobj$thresholds, y = rev(rocobj$thresholds))) +
    geom_text(aes(x = 0.25, y = 0.25), label = paste(&quot;AUC:&quot;,round(rocobj$auc,4))) +
    ggtitle(&quot;ROC curve&quot;)
  
  # Plot confusion matrix
  p2 &lt;- cm$table %&gt;% as.data.frame() %&gt;% 
    ggplot(aes(x = Reference, y = Prediction)) +
    geom_tile(aes(fill = log(Freq)), colour = &quot;white&quot;) +
    scale_fill_gradient(low = &quot;white&quot;, high = &quot;steelblue&quot;) +
    geom_text(aes(x = Reference, y = Prediction, label = Freq)) +
    theme(legend.position = &quot;none&quot;) +
    ggtitle(paste(&quot;Accuracy&quot;, signif(cm$overall[1], digits = 4), &quot;| Kappa&quot;, signif(cm$overall[2], digits = 4)))
  
  grid.arrange(grobs = list(p2, p1),widths = c(1, 1.2))
}</code></pre>
<pre class="r"><code>run.xgb &lt;- function(traind, testd){
  # Convert dataframe -&gt; matrix, factors -&gt; numeric (0,1) 
  mat_train &lt;- as.matrix(subset(traind, select=-c(CARAVAN)))
  clabel &lt;- (as.numeric(as.factor(traind$CARAVAN)) - 1)
  dtrain &lt;- xgb.DMatrix(data = mat_train, label = clabel)
  
  # Train model on converted training data
  bstDMatrix &lt;- xgboost(data = dtrain, max.depth = 3, eta = 1, nthread = 4, nrounds = 2, objective = &quot;binary:logistic&quot;)
  
  # Convert test data into compatable matrix, numeric format
  mat_test &lt;- as.matrix(subset(testd, select=-CARAVAN))
  clabel_test &lt;- (as.numeric(as.factor(testd$CARAVAN)) - 1)
  dtest &lt;- xgb.DMatrix(data = mat_test, label = clabel_test)
  
  # Predict test data and convert to binary output
  preds_x &lt;- predict(bstDMatrix, dtest)
  preds_x.bin &lt;- as.factor(ifelse(preds_x &gt; 0.5, 1, 0))
  
  # Plot confusion matrix and ROC AUC 
  cfmROC(preds_x.bin, as.factor(clabel_test))
  
  return(bstDMatrix)
}</code></pre>
<pre class="r"><code>run.model &lt;- function(method=&quot;rf&quot;, traind, testd){
  # XGBoost is a seperate package from caret, so we modifiy our wrapper function to pass it to run.xgb
  if (method==&quot;xgb&quot;) return(run.xgb(traind, testd))
  
  mod &lt;- train(CARAVAN ~ ., data = traind, 
               method = method,
               metric = &quot;ROC&quot;,
               preProcess = c(&quot;scale&quot;, &quot;center&quot;),
               trControl = ctrl)

  pred &lt;- predict(mod, subset(testd, select=-CARAVAN))
  cfmROC(pred, testd$CARAVAN)
  
  return(mod)
}</code></pre>
<p>Defining a few helper functions drastically reduces the amount of repeatitious code required. The <code>caret</code> package makes this very easy for us by accepting nearly identical baseline parameters for all models.</p>
<pre class="r"><code>ctrl &lt;- trainControl(method = &quot;none&quot;, classProbs = TRUE)</code></pre>
<p>This will serve as the baseline training control for all models. Setting method to “none” disables cross validation, we could certainly build better models with CV enabled, but it significantly increases training time, later notebooks will explore this in detail. Setting <code>classProbs=TRUE</code> gives us probabilities rather than binary outputs and so that <code>ROC</code> may be used as our evaluation metric.</p>
<div id="unbalanced" class="section level3">
<h3>Unbalanced</h3>
<p>To establish a frame of reference, we will first try running all four models against the original data, making to attempts to correct the imbalance.</p>
<div id="bagging" class="section level4">
<h4>Bagging</h4>
<pre class="r"><code>bag_orig &lt;- train(CARAVAN ~ ., data = train_data,
                  method = &quot;treebag&quot;,
                  metric = &quot;ROC&quot;,
                  preProcess = c(&quot;scale&quot;, &quot;center&quot;),
                  trControl = ctrl)

preds &lt;- predict(bag_orig, subset(test_data, select=-CARAVAN))
head(preds)</code></pre>
<pre><code>## [1] No No No No No No
## Levels: No Yes</code></pre>
<p>It is all too easy to be mislead by a high accuracy score, 91.6% would be quite good if we were dealing with balanced data, but with this set being as imbalanced as it is, this score is actually worse than if the model had just chosen 0(‘No’) for every sample, taking this route would have yielded ~94% accuracy.</p>
<pre class="r"><code>cfmROC(preds,test_data$CARAVAN)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-12-1.png" width="768" /></p>
</div>
<div id="boosting-adaboost" class="section level4">
<h4>Boosting (Adaboost)</h4>
<pre class="r"><code>ada_orig &lt;- train(CARAVAN ~ ., data = train_data,
                  method = &quot;ada&quot;,
                  metric = &quot;ROC&quot;,
                  preProcess = c(&quot;scale&quot;, &quot;center&quot;),
                  trControl = ctrl)

pred &lt;- predict(ada_orig, subset(test_data, select=-CARAVAN))

cfmROC(pred, test_data$CARAVAN)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-13-1.png" width="768" /></p>
</div>
<div id="random-forest" class="section level4">
<h4>Random Forest</h4>
<pre class="r"><code>rf_orig &lt;- train(CARAVAN ~ ., data = train_data, 
                      method = &quot;rf&quot;,
                      metric = &quot;ROC&quot;,
                      preProcess = c(&quot;scale&quot;, &quot;center&quot;),
                      trControl = ctrl)

pred &lt;- predict(rf_orig, subset(test_data, select=-CARAVAN))
cfmROC(pred, test_data$CARAVAN)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-14-1.png" width="768" /></p>
</div>
<div id="xgboost" class="section level4">
<h4>XGBoost</h4>
<pre class="r"><code>mat_train &lt;- as.matrix(subset(train_data,select=-CARAVAN))
c_label &lt;- (as.numeric(as.factor(train_data$CARAVAN)) - 1)</code></pre>
<p>XGBoost requires matrices rather than data.frames for inputs. It also requiress binary response variables (0,1) rather than factors. R is 1 indexed rather than 0 indexed, so subtracting 1 from a numeric convertion achieves these requirements.</p>
<pre class="r"><code>dtrain &lt;- xgb.DMatrix(data = mat_train, label = c_label)

xgb_orig &lt;- xgboost(data = dtrain, 
                      max.depth = 3, 
                      eta = 1, # learning rate
                      nthread = 4, # multithreading support
                      nrounds = 2, 
                      objective = &quot;binary:logistic&quot;)</code></pre>
<pre><code>## [1]  train-error:0.059183 
## [2]  train-error:0.059454</code></pre>
<pre class="r"><code># Preform the same transformations on the test data
mat_test &lt;- as.matrix(subset(test_data,select=-CARAVAN))
c_label_test &lt;- (as.numeric(as.factor(test_data$CARAVAN)) - 1)
dtest &lt;- xgb.DMatrix(data = mat_test, label = c_label_test)

preds_xgb &lt;- predict(xgb_orig, dtest)</code></pre>
<pre class="r"><code># convert xgb&#39;s predicted probabilities back into binary output 
cfmROC(as.factor(ifelse(preds_xgb &gt; 0.5, 1, 0)), as.factor(c_label_test))</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-18-1.png" width="768" /></p>
</div>
</div>
<div id="downsampling" class="section level3">
<h3>Downsampling</h3>
<p><strong>Random Downsampling</strong> - balances data by randomly under under selecting from the majority class, those who did not purchase caravan insurance.</p>
<div id="bagging-1" class="section level4">
<h4>Bagging</h4>
<pre class="r"><code>bag_down &lt;- train(CARAVAN ~ ., data = down_train, 
                      method = &quot;treebag&quot;,
                      metric = &quot;ROC&quot;,
                      preProcess = c(&quot;scale&quot;, &quot;center&quot;),
                      trControl = ctrl)

pred &lt;- predict(bag_down, subset(test_data, select=-CARAVAN))
cfmROC(pred,test_data$CARAVAN)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-19-1.png" width="768" /></p>
<p>The only change moving between data resamplings is the <code>data = ..</code> parameter, every other will be fixed constant. Hereafter, we can use the nice little wrapper function <code>run.model</code> to help keep us <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a>.</p>
</div>
<div id="boosting-adaboost-1" class="section level4">
<h4>Boosting (Adaboost)</h4>
<pre class="r"><code>ada_down &lt;- run.model(method = &quot;ada&quot;, traind = down_train, testd = test_data)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-20-1.png" width="768" /></p>
</div>
<div id="random-forest-1" class="section level4">
<h4>Random Forest</h4>
<pre class="r"><code>rf_down &lt;- run.model(method = &quot;rf&quot;, traind = down_train, testd = test_data)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-21-1.png" width="768" /></p>
</div>
<div id="xgboost-1" class="section level4">
<h4>XGBoost</h4>
<pre class="r"><code>xgb_down &lt;- run.model(method = &quot;xgb&quot;, traind = down_train, testd = test_data)</code></pre>
<pre><code>## [1]  train-error:0.332955 
## [2]  train-error:0.286364</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-22-1.png" width="768" /></p>
</div>
</div>
<div id="upsampling" class="section level3">
<h3>Upsampling</h3>
<p><strong>Random Upsampling</strong> - attempts to balance the data by randomly selecting from the minority class, in this case, those who did purchase a caravan insurance policy.</p>
<div id="bagging-2" class="section level4">
<h4>Bagging</h4>
<pre class="r"><code>bag_up &lt;- run.model(method = &quot;treebag&quot;, up_train, test_data)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-23-1.png" width="768" /></p>
</div>
<div id="boosting-adaboost-2" class="section level4">
<h4>Boosting (Adaboost)</h4>
<pre class="r"><code>ada_up &lt;- run.model(method = &quot;ada&quot;, up_train, test_data)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-24-1.png" width="768" /></p>
</div>
<div id="random-forest-2" class="section level4">
<h4>Random Forest</h4>
<pre class="r"><code>rf_up &lt;- run.model(method = &quot;rf&quot;, up_train, test_data)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-25-1.png" width="768" /></p>
</div>
<div id="xgboost-2" class="section level4">
<h4>XGBoost</h4>
<pre class="r"><code>xgb_up &lt;- run.model(method = &quot;xgb&quot;, up_train, test_data)</code></pre>
<pre><code>## [1]  train-error:0.317814 
## [2]  train-error:0.305688</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-26-1.png" width="768" /></p>
</div>
</div>
<div id="smote" class="section level3">
<h3>SMOTE</h3>
<p><strong>SMOTE</strong> - Synthetic Minority Over-sampling Technique, constructs new synthetic data by sampling neighboring points. Balancing happens through both oversampling the minority and undersampling the major class.</p>
<div id="bagging-3" class="section level4">
<h4>Bagging</h4>
<pre class="r"><code>bag_smote &lt;- run.model(method = &quot;treebag&quot;, smote_train, test_data)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-27-1.png" width="768" /></p>
</div>
<div id="boosting-adaboost-3" class="section level4">
<h4>Boosting (Adaboost)</h4>
<pre class="r"><code>ada_smote &lt;- run.model(method = &quot;ada&quot;, smote_train, test_data)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-28-1.png" width="768" /></p>
</div>
<div id="random-forest-3" class="section level4">
<h4>Random Forest</h4>
<pre class="r"><code>rf_smote &lt;- run.model(method = &quot;rf&quot;, smote_train, test_data)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-29-1.png" width="768" /></p>
</div>
<div id="xgboost-3" class="section level4">
<h4>XGBoost</h4>
<pre class="r"><code>xgb_smote &lt;- run.model(method = &quot;xgb&quot;, smote_train, test_data)</code></pre>
<pre><code>## [1]  train-error:0.234091 
## [2]  train-error:0.183117</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-30-1.png" width="768" /></p>
</div>
</div>
<div id="feature-importance" class="section level3">
<h3>Feature Importance</h3>
<pre class="r"><code>bag_orig.imp &lt;- varImp(bag_orig, scale=FALSE)
ada_orig.imp &lt;- varImp(ada_orig, scale = FALSE)
rf_orig.imp &lt;- varImp(rf_orig, scale=FALSE)
xgb_orig.imp &lt;- xgb.importance(model = xgb_orig)</code></pre>
<pre class="r"><code>library(docstring)

get.imps &lt;- function(models = list(bag,ada,rf,xgb)){
  #&#39; Calculates feature importances
  #&#39;
  #&#39; Calculates and returns all 4 models&#39; feature importances
  #&#39;
  #&#39; @param models a list of models to calculate feature importance. Must be exactly in parameter order specified
  
  caret.imps &lt;- lapply(models[1:3], varImp, scale=FALSE)
  imps &lt;- lapply(caret.imps, getElement, name=&#39;importance&#39;)
  imps[[4]] &lt;- xgb.importance(model = models[[4]])
  return(imps)
}</code></pre>
<pre class="r"><code>plot.featimps &lt;- function(resample.method=&quot;Unbalanced&quot;){
  #&#39; Plot feature importances
  #&#39;
  #&#39; Plots all four models feature importances
  #&#39;
  #&#39; @param resample.method model set to use: (&quot;Unbalanced&quot; | &quot;Downsampled&quot; | &quot;Upsampled&quot; | &quot;SMOTE&quot;)
  #&#39;
  
  if(grepl(&quot;(unb|ori).*&quot;,resample.method,ignore.case = TRUE)){
    resample.method &lt;- &quot;Unbalanced&quot;
    imps &lt;- get.imps(list(bag_orig, ada_orig, rf_orig, xgb_orig))
  }else if(grepl(&quot;(und|dow).*&quot;,resample.method, ignore.case = TRUE)){
    resample.method &lt;- &quot;Downsampled&quot;
    imps &lt;- get.imps(list(bag_down, ada_down, rf_down, xgb_down))
  }else if(grepl(&quot;(up|ove).*&quot;,resample.method, ignore.case = TRUE)){
    resample.method &lt;- &quot;Upsampled&quot;
    imps &lt;- get.imps(list(bag_up, ada_up, rf_up, xgb_up))
  }else if(grepl(&quot;sm.*&quot;,resample.method, ignore.case = TRUE)){
    resample.method &lt;- &quot;SMOTE&quot;
    imps &lt;- get.imps(list(bag_smote, ada_smote, rf_smote, xgb_smote))
  } else stop(&quot;invalid resample selection (&#39;orig&#39;|&#39;down&#39;|&#39;up&#39;|&#39;smote&#39;)&quot;)
  
  # resample.method &lt;- ifelse(grepl(&quot;(unba|ori).+&quot;,resample.method,ignore.case = TRUE),&quot;Unbalanced&quot;,resample.method)
  # resample.method &lt;- ifelse(grepl(&quot;(und|dow).+&quot;,resample.method, ignore.case = TRUE),&quot;Downsampled&quot;,resample.method)
  # resample.method &lt;- ifelse(grepl(&quot;(up|ove).+&quot;,resample.method, ignore.case = TRUE),&quot;Upsampled&quot;,resample.method)
  # resample.method &lt;- ifelse(grepl(&quot;sm.+&quot;,resample.method, ignore.case = TRUE),&quot;SMOTE&quot;,resample.method)

  # imps &lt;- switch (resample.method,
  #   Unbalanced = get.imps(list(bag_orig, ada_orig, rf_orig, xgb_orig)),
  #   Downsampled = get.imps(list(bag_down, ada_down, rf_down, xgb_down)),
  #   Upsampled = get.imps(list(bag_up, ada_up, rf_up, xgb_up)),
  #   SMOTE = get.imps(list(bag_smote, ada_smote, rf_smote, xgb_smote))
  # )
  
  # Bagging
  p1 &lt;- imps[[1]] %&gt;% 
    transmute(Feature=as.factor(row.names(imps[[1]])),Importance=Overall ) %&gt;% 
    top_n(10) %&gt;% 
    ggplot(aes(x=reorder(Feature,Importance), fill=Feature, weight=Importance)) +
    geom_bar() +
    coord_flip() +
    theme(legend.position=&quot;none&quot;) +
    labs(x=&quot;Feature&quot;, y=NULL, title=paste(&quot;Bagging&quot;,resample.method))
  
  # Boosting
  p2 &lt;- imps[[2]] %&gt;% 
    transmute(Feature=as.factor(row.names(imps[[2]])),Importance=((No+Yes)-1)) %&gt;% 
    top_n(10) %&gt;% 
    ggplot(aes(x=reorder(Feature,Importance), fill=Feature, weight=Importance)) +
    geom_bar() +
    coord_flip() +
    theme(legend.position=&quot;none&quot;) +
    labs(x=NULL, y=NULL, title=paste(&quot;Boosting (Ada)&quot;,resample.method))
  
  # Random Forest
  p3 &lt;- imps[[3]] %&gt;% 
    transmute(Feature=as.factor(row.names(imps[[3]])),Importance=Overall/100) %&gt;% 
    top_n(10) %&gt;% 
    ggplot(aes(x=reorder(Feature,Importance), fill=Feature, weight=Importance)) +
    geom_bar() +
    coord_flip() +
    theme(legend.position=&quot;none&quot;) +
    labs(x=&quot;Feature&quot;, y=&quot;Importance&quot;, title=paste(&quot;Random Forest&quot;,resample.method)) 
  
  #XGBoost
  p4 &lt;- xgb.ggplot.importance(imps[[4]]) + 
    geom_col(aes(width=0.8, fill=Cluster)) +
    labs(x=NULL, y=&quot;Importance&quot;, title=paste(&quot;XGBoost&quot;,resample.method)) +
    theme(plot.title = element_text(face=&quot;plain&quot;))
  
  grid.arrange(p1,p2,p3,p4, layout_matrix=rbind(c(1,2),c(3,4)))

}</code></pre>
<pre class="r"><code>grepl(&quot;sm.+&quot;,&quot;smt&quot;, ignore.case = TRUE)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>plot.featimps(&quot;Unbalanced&quot;)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-34-1.png" width="960" /></p>
<pre class="r"><code>plot.featimps(&quot;Down&quot;)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-35-1.png" width="960" /></p>
<pre class="r"><code>plot.featimps(&quot;Up&quot;)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-36-1.png" width="960" /></p>
<pre class="r"><code>plot.featimps(&quot;SMOTE&quot;)</code></pre>
<p><img src="/assets/images/rimgs/2018-12-22-unbalanced-bag-boost-rf_files/figure-html/unnamed-chunk-37-1.png" width="960" /></p>
</div>
</div>
<div id="conclusions" class="section level2">
<h2>Conclusions</h2>
<p>In this notebook, we explored the CoIL Challenge 2000 datamining competition dataset. 4 Different models were used:<br> A BaggingClassifer, AdaBoost, Random Forrest, and XGBoost.</p>
<p>For each of these models, we 4 variants of the same training dataset:<br> Unaltered, Undersampled, Oversampled, and SMOTE.</p>
<p>We determined that without altering the data, the ROC score is no better than randomly guessing, Oversampling and SMOTE performed slightly better, but Undersampling was clearly the best approach.</p>
<p>After testing each model with the data modifications, a brute force method of Hyperparameter tuning was attempted via GridSearch followed by an automated means of feature selection. Neither of these methods yielded substantially better results for the compute time they required.</p>
<p>The highest end <strong>ROC score</strong> we were able to achieve in the synthetic competition environment was <strong>0.66</strong> with a overtuned Random Forest. The highest local test score was <strong>0.784</strong>, showing that the model was clearly beginning to overfit the data.</p>
<p>At this time, I am unable to answer the question of: &gt; Who is interested in buying Caravan Insurance and why?</p>
<p>with any degree of certainty. <a href="https://web.archive.org/web/20150122025408/http://www.liacs.nl:80/~putten/library/cc2000/ELKANP~1.pdf">The winner</a> of the 2000 challenge determined the strongest indicators variables were number of car policies, buying power, and various other policies held.</p>
<p>Future work: Countless parameters have been left untweaked, each model could have it’s own grid search with each hyperparameter explored. As mentioned earlier, there was an issue with collinearity between percentage variables and number variables, this should be explored further. There is a great deal of EDA left undone, deeper relationships between variables should be investigated through interactions and transformations. Additionally, since this dataset is comprised largely of categorical variables, ordinal or otherwise, CatBoost might be a pragmatic choice for modeling, even attempting to use a Neural Network may yield interesting results.</p>
<div id="references" class="section level3">
<h3>References</h3>
<p><strong>Code &amp; Docs</strong><br> <a href="https://shiring.github.io/machine_learning/2017/04/02/unbalanced" class="uri">https://shiring.github.io/machine_learning/2017/04/02/unbalanced</a></p>
<p><a href="https://topepo.github.io/caret/subsampling-for-class-imbalances.html" class="uri">https://topepo.github.io/caret/subsampling-for-class-imbalances.html</a></p>
<p><a href="https://amunategui.github.io/binary-outcome-modeling/" class="uri">https://amunategui.github.io/binary-outcome-modeling/</a></p>
<p><a href="http://dpmartin42.github.io/posts/r/imbalanced-classes-part-1" class="uri">http://dpmartin42.github.io/posts/r/imbalanced-classes-part-1</a></p>
<p><a href="https://stackoverflow.com/questions/46063234/how-to-produce-a-confusion-matrix-and-find-the-misclassification-rate-of-the-na%C3%AF" class="uri">https://stackoverflow.com/questions/46063234/how-to-produce-a-confusion-matrix-and-find-the-misclassification-rate-of-the-na%C3%AF</a></p>
<p><a href="https://cran.r-project.org/web/packages/egg/vignettes/Ecosystem.html" class="uri">https://cran.r-project.org/web/packages/egg/vignettes/Ecosystem.html</a></p>
<p><a href="https://rpubs.com/Wangzf/pROC" class="uri">https://rpubs.com/Wangzf/pROC</a></p>
<p><strong>Text:</strong> <br> <a href="https://www.kaggle.com/uciml/caravan-insurance-challenge/home" class="uri">https://www.kaggle.com/uciml/caravan-insurance-challenge/home</a></p>
<p>Definitions</p>
<p><a href="http://glemaitre.github.io/imbalanced-learn/generated/imblearn.over_sampling.RandomOverSampler.html" class="uri">http://glemaitre.github.io/imbalanced-learn/generated/imblearn.over_sampling.RandomOverSampler.html</a></p>
<p><a href="http://glemaitre.github.io/imbalanced-learn/generated/imblearn.under_sampling.RandomUnderSampler.html" class="uri">http://glemaitre.github.io/imbalanced-learn/generated/imblearn.under_sampling.RandomUnderSampler.html</a></p>
<p><a href="http://glemaitre.github.io/imbalanced-learn/generated/imblearn.over_sampling.SMOTE.html" class="uri">http://glemaitre.github.io/imbalanced-learn/generated/imblearn.over_sampling.SMOTE.html</a></p>
<p><strong>Other:</strong><br> <a href="https://web.archive.org/web/20160818233319/http://www.wi.leidenuniv.nl/~putten/library/cc2000/" class="uri">https://web.archive.org/web/20160818233319/http://www.wi.leidenuniv.nl/~putten/library/cc2000/</a></p>
<p><a href="https://github.com/jayanttikmani/cross-sellingCaravanInsuranceUsingDataMining/" class="uri">https://github.com/jayanttikmani/cross-sellingCaravanInsuranceUsingDataMining/</a></p>
<p><a href="https://www.statmethods.net/input/valuelabels.html" class="uri">https://www.statmethods.net/input/valuelabels.html</a></p>
<p><a href="https://campus.datacamp.com/courses/free-introduction-to-r/chapter-4-factors-4?ex=4" class="uri">https://campus.datacamp.com/courses/free-introduction-to-r/chapter-4-factors-4?ex=4</a></p>
<p><a href="https://stackoverflow.com/questions/5869539/confusion-between-factor-levels-and-factor-labels" class="uri">https://stackoverflow.com/questions/5869539/confusion-between-factor-levels-and-factor-labels</a></p>
<p><a href="https://r4ds.had.co.nz/exploratory-data-analysis.html" class="uri">https://r4ds.had.co.nz/exploratory-data-analysis.html</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
